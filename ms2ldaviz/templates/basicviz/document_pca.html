{% extends 'base.html' %}
{% load static %}
{% block body_block %}
	<meta charset='utf-8'>

	<!-- Stlye to get nice plot axis -->
	<style>
		.axis path,
		.axis line {
		    fill: none;
		    stroke: black;
		    shape-rendering: crispEdges;
		}
		.axis text {
		    font-family: sans-serif;
		    font-size: 11px;
		}
</style>

	<link rel="stylesheet" type="text/css" href="{% static "css/jquery-ui.css" %}">
	<link rel="stylesheet" type="text/css" href="{% static "css/basicviz.css" %}">

	<script type='text/javascript' src="{% static "js/jquery-2.2.2.min.js" %}"></script>
	<script type='text/javascript' src="{% static "js/jquery-ui.min.js" %}"> </script>
	<script type='text/javascript' src="{% static "js/d3.v3.min.js" %}"></script>
	<script type='text/javascript' src="{% static "js/d3.tip.v0.6.3.js" %}"> </script>


	{% if experiment %}
		<h3>Experiment {{ experiment.name }}</h3>
	{% endif %}
	<a href="/basicviz">return to visualisation menu</a>

	<div id='pca_div' width=1000 height=1000>
	</div>

	<script>
	var experiment_id = '{{ experient.id }}'
	var plot_width=800
	var plot_height=500
	var hor_margin = 50
	var ver_margin = 50

	d3.json('/basicviz/get_pca_data/{{experiment.id}}/',function(error,dataset) {
        if (error) throw error;
        pca_plot(dataset)
        $('#message').fadeOut('fast');
    });

	function pca_plot(pca_data) {
	// var pca_data = [[1,-1,'urine1','#aabbcc'],[3,4,'beer1','#aa0000'],[-3,6,'urine2','#aabbcc']]
		var pca_plot_svg = d3.select("#pca_div")
	               .append("svg")
	                    .attr("width",plot_width)
	                    .attr("height",plot_height)
	                    .attr("id","pca_plot_svg")
	    var circles = pca_plot_svg.selectAll("circle")
	            .data(pca_data)
	            .enter()
	            .append("circle")
	            .on("click",function(d) {
	                console.log(d);
	            })
	    // Axis scale objects
	    var max_x = d3.max(pca_data,function(d) {return d[0]+1})
	    var min_x = d3.min(pca_data,function(d) {return d[0]-1})
	    var max_y = d3.max(pca_data,function(d) {return d[1]+1})
	    var min_y = d3.min(pca_data,function(d) {return d[1]-1})

	    var xScale = d3.scale.linear()
	    xScale.domain([min_x, max_x])
	    xScale.range([ hor_margin,plot_width-hor_margin])
	    var yScale = d3.scale.linear()
	    yScale.domain([min_y,max_y])
	    yScale.range([plot_height-ver_margin,ver_margin])


	    var xAxis = d3.svg.axis()
	        .scale(xScale)
	        .orient("bottom");

	    pca_plot_svg.append("g")
	        .attr("class", "axis")
	        .attr("transform", "translate(0," + yScale(0) + ")")
	        .call(xAxis);

	    var yAxis = d3.svg.axis()
	        .scale(yScale)
	        .orient("left");

	    pca_plot_svg.append("g")
	        .attr("class","axis")
	        .attr("transform","translate(" + xScale(0) + ",0)")
	        .call(yAxis);

	    circles.attr("cx",function(d) {return xScale(d[0])})
	    		.attr("cy",function (d) {return yScale(d[1])})
	    		.attr("r",2)
	    		.attr('fill',function(d) {return d[3]});

	    
    }

	</script>
{% endblock %}