{% extends 'base.html' %}

{% load static %}

{% block head_block %}
	<style>
		.axis path,
		.axis line {
		    fill: none;
		    stroke: black;
		    shape-rendering: crispEdges;
		}
		.axis text {
		    font-family: sans-serif;
		    font-size: 11px;
		}
		.axis-label {
		  font-family: sans-serif;
		  font-size: 14px;
		}
	</style>
{% endblock %}

{% block body_block %}
	<h3>Mass2Motif: {{mass2motif.name}} ({{mass2motif.experiment.name}})</h3>
	<h4>{{mass2motif.annotation}}</h4>
	<a href="/basicviz/view_mass2motifs/{{mass2motif.experiment.id}}">return to mass2motif list for {{mass2motif.experiment.name}}</a>
 	<hr />
	<div>
	<p>{{ status }}</p>
	<form id="mass2motifmetadata_form" method="post" action="/basicviz/view_parents/{{mass2motif.id}}/">
		{% csrf_token %}
	{% for hidden in metadata_form.hidden_fields %}
	 	{{ hidden }}
	{% endfor %}

	{% for field in metadata_form.visible_fields %}
		{{ field.errors }}
		{{ field }}
	{% endfor %}
	<input type="submit" name="submit" value="Modify metadata" />
	</form>
	</div>
	<hr />

	<div id="spectra" border="20" padding="20"></div>

	<div>
	<h3>Mass2Motif details</h3>
	<p>After thresholding to save the model, the total probability left in this motif is {{total_prob}}</p>
		<table class='table' id='featuretable'>
			<thead>
			<tr><th>Name</th><th>Probability</th><th>link</th></tr>
			</thead>
			<tbody>
			{% for motif_feature in motif_features %}
				<tr><td>{{motif_feature.feature.name}}</td><td>{{motif_feature.probability}}</td>
				<td><a href="/basicviz/mass2motif_feature/{{motif_feature.id}}">details</a></td></tr>
			{% endfor %}
			</tbody>
		</table>
	</div>

	<hr />

	<div>
	<h3>Documents in Mass2Mitif</h3>
		<table class='table' id='doctable'>
			<thead>
				<tr><th>Document name</th><th>Doc Annotation</th><th>Probability</th><th>Overlap Score</th></tr>
			</thead>
			<tbody>
				{% for dm2m in dm2ms %}
					<tr><td><a href="/basicviz/show_doc/{{dm2m.document.id}}">{{dm2m.document.name}}</a></td><td>{{dm2m.document.annotation}}</td><td>{{dm2m.probability}}</td><td>{{dm2m.overlap_score}}</td></tr>
				{% endfor %}
			</tbody>
		</table>
	<hr />


	<div id="graphs">
	</div>
{% endblock %}

{% block js_block %}
	<script type='text/javascript' src="{% static "js/d3.v3.min.js" %}"></script>
	<script type='text/javascript' src="{% static "js/d3.tip.v0.6.3.js" %}"> </script>
	<script type='text/javascript' src="{% static "js/basicviz-spectra.js" %}"></script>
	<script type='text/javascript' src="{% static "js/word-graph.js" %}"></script>

	<script src="{% static 'js/dataTables/jquery.dataTables.min.js' %}"></script>
	<script src="{% static 'js/dataTables/dataTables.bootstrap.min.js' %}"></script>

	<script src="{% static 'js/dataTables/dataTables.buttons.min.js' %}"></script>
	<script src="{% static 'js/dataTables/buttons.html5.min.js' %}"></script>

	<link rel="stylesheet" href="{% static 'js/dataTables/dataTables.bootstrap.min.css' %}" type="text/css">
	<link rel="stylesheet" href="{% static 'js/dataTables/buttons.dataTables.min.css' %}" type="text/css">


	<script type="text/javascript">
		var current_pos = 0
		var motif_name = '{{mass2motif.name}}'
		var motif_id = '{{mass2motif.id}}'
		load_parents(motif_id, motif_name,-1);
		var url = '/basicviz/get_word_graph/{{mass2motif.id}}/nan/'
		plot_word_graph(url,motif_id,motif_name)
		url = '/basicviz/get_intensity/{{mass2motif.id}}/nan/'
		plot_word_graph(url,motif_id,motif_name)


		$(document).ready(function() {
			$('#featuretable').DataTable({
				dom: 'Bfrtip',
				buttons: [
			        'csv',
		        ],
		        "order": [[ 1, "desc" ]],
		    });
			$('#doctable').DataTable({
				dom: 'Bfrtip',
				buttons: [
			        'csv',
		        ],
		        "order": [[ 2, "desc" ]],
		    });

		});
	</script>


{% endblock %}